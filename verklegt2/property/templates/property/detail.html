{% extends "base.html" %}
{% load humanize %}


{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
  <h1 class="text-3xl font-bold mb-4">{{ property.title }}</h1>

  <!-- Main image -->
  {% if property.main_image %}
      <div class="relative">
        <img
          src="{{ property.main_image.url }}"
          alt="Main Image"
          class="w-full rounded-md mb-6"
        />
        {% if property.is_sold %}
          <span class="absolute top-3 left-3 bg-red-500 text-white text-2xl font-semibold px-4 py-0.5 rounded">
            Property Sold
          </span>
        {% endif %}
      </div>
  {% endif %}

  <!-- Extra images -->
  {% if property.images.all %}
    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
      {% for image in property.images.all %}
        <div>
          <img src="{{ image.image.url }}" alt="{{ image.caption }}" class="rounded-md shadow-sm" />
          {% if image.caption %}
            <p class="text-sm text-gray-500 mt-1">{{ image.caption }}</p>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Property details -->
  <div class="mb-6">
    <h2 class="text-xl font-semibold mb-2">Property Details</h2>
    <p class="text-gray-600 mb-2"><strong>Type:</strong> {{ property.property_type }}</p>
    <p class="text-gray-600 mb-2"><strong>Year Built:</strong> {{ property.year_built }}</p>
    <p class="text-gray-600 mb-2"><strong>Location:</strong> {{ property.address }}, {{ property.city }} {{ property.zip_code }}</p>
    <p class="text-gray-600 mb-2"><strong>Price:</strong> ${{ property.price|floatformat:"0"|intcomma }}</p>
    <p class="text-gray-600 mb-2"><strong>Bedrooms:</strong> {{ property.bedrooms }}</p>
    <p class="text-gray-600 mb-2"><strong>Bathrooms:</strong> {{ property.bathrooms }}</p>
    <p class="text-gray-600 mb-2"><strong>Size:</strong> {{ property.sqft }} sq ft</p>
    <hr class="my-6" />
    <p>{{ property.description }}</p>
  </div>

  {% if property.owner == user %}
    <form action="{% url 'property:toggle_property_sold' property.id %}" method="POST">
      {% csrf_token %}
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
        {% if property.is_sold %}
          Mark as Available
        {% else %}
          Mark as Sold
        {% endif %}
      </button>
    </form>
    <a href="{% url 'property:edit' property.id %}" class="inline-block mt-4 bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
      Edit Listing
    </a>
    <form action="{% url 'property:delete' property.id %}" method="POST" class="mt-4">
      {% csrf_token %}
      <button type="submit" onclick="return confirm('Are you sure you want to delete this property?');"
      class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
      Delete Property
      </button>
    </form>
  {% endif %}
</div>
{% endblock %}
